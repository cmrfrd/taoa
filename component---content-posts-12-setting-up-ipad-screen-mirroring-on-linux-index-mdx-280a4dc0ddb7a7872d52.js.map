{"version":3,"file":"component---content-posts-12-setting-up-ipad-screen-mirroring-on-linux-index-mdx-280a4dc0ddb7a7872d52.js","mappings":"iRAQaA,EAAe,CAAC,EACvBC,EAAc,CAClBD,aAAAA,GAEIE,EAAYC,EAAAA,EACH,SAASC,EAAT,GAGX,IAFFC,EAEC,EAFDA,WACGC,GACF,YACD,OAAO,QAACJ,GAAD,UAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,eAG5E,8PAGA,gTAIA,cACE,GAAM,iBADR,kBAGA,mBACE,cAAIC,WAAW,MAAf,gDACA,cAAIA,WAAW,MAAf,yCAA6D,aAAGA,WAAW,KACvE,KAAQ,sBADiD,SAA7D,MAGA,cAAIA,WAAW,MAAf,sDAEF,wIAEA,cACE,GAAM,2CADR,4CAGA,sEAAwD,aAAGA,WAAW,IAClE,KAAQ,kCAD4C,WAAxD,8FAIA,sFAAwE,aAAGA,WAAW,IAClF,KAAQ,kCAD4D,UAAxE,oEAGqD,sBAAYA,WAAW,KAAvB,WAHrD,MAIA,4EAA8D,sBAAYA,WAAW,KAAvB,6BAA9D,uHAEsD,aAAGA,WAAW,IAChE,KAAQ,qEAD0C,oBAFtD,0CAMA,wDAA0C,aAAGA,WAAW,IACpD,KAAQ,oCAD8B,SAA1C,6BAE+C,aAAGA,WAAW,IACzD,KAAQ,0GADmC,iCAF/C,8BAKmD,sBAAYA,WAAW,KAAvB,qBALnD,iBAMA,oBAAK,gBAAMA,WAAW,MAClB,UAAa,gBADZ,0JAYL,iCAAmB,sBAAYA,WAAW,KAAvB,wBAAnB,gCACA,oBAAK,gBAAMA,WAAW,MAClB,UAAa,iBADZ,6xBAqBL,2HAEA,kBAAG,gBAAMA,WAAW,IAChB,UAAa,4BACb,MAAS,CACP,SAAY,WACZ,QAAW,QACX,WAAc,OACd,YAAe,OACf,SAAY,UAPf,YAUC,gBAAMA,WAAW,OACf,UAAa,qCACb,MAAS,CACP,cAAiB,qBACjB,SAAY,WACZ,OAAU,IACV,KAAQ,IACR,gBAAmB,y0BACnB,eAAkB,QAClB,QAAW,WAnBhB,QAsBH,mBAASA,WAAW,QAApB,gBACQ,kBAAQA,WAAW,UACnB,OAAU,CAAC,4EACX,MAAS,kCACT,KAAQ,eAJhB,gBAMQ,kBAAQA,WAAW,UACnB,OAAU,CAAC,2EACX,MAAS,kCACT,KAAQ,eAThB,gBAWQ,eAAKA,WAAW,UAChB,UAAa,0BACb,IAAO,qEACP,IAAO,MACP,MAAS,yBACT,QAAW,OACX,SAAY,QACZ,MAAS,CACP,MAAS,OACT,OAAU,OACV,OAAU,IACV,cAAiB,SACjB,SAAY,WACZ,IAAO,IACP,KAAQ,OAzBlB,cAtBG,YAoDH,kHAEA,6IACuC,sBAAYA,WAAW,KAAvB,uCADvC,aAEK,sBAAYA,WAAW,KAAvB,qBAFL,gEAIA,gNAGA,oBAAK,gBAAMA,WAAW,MAClB,UAAa,iBADZ,i1DAmFL,oBAAK,gBAAMA,WAAW,MAClB,UAAa,eADZ,kcAaL,iCAAmB,aAAGA,WAAW,IAC7B,KAAQ,mEADO,QAAnB,2BAGA,yIAEA,4IAEA,mBACE,cAAIA,WAAW,MAAf,yBAA6C,aAAGA,WAAW,KACvD,KAAQ,6BADiC,6BAA7C,MAGA,cAAIA,WAAW,MAAf,cAAkC,aAAGA,WAAW,KAC5C,KAAQ,+CADsB,+CAAlC,MAGA,cAAIA,WAAW,MAAf,4CACH,aAAGA,WAAW,KACP,KAAQ,uEADf,uEADG,MAIA,cAAIA,WAAW,MAAf,sBAA0C,aAAGA,WAAW,KACpD,KAAQ,gEAD8B,gEAA1C,OAIF,oIAEA,mCAGH,CAEDJ,EAAWK,gBAAiB,C","sources":["webpack://TAOA/./content/posts/12_setting_up_ipad_screen_mirroring_on_linux/index.mdx"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/node/work/src/templates/post.template.tsx\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <p>{`Recently I bought an iPad so I can live share my notes to my laptop during\nscreencasts. This is incredibly useful for online meetings, presentations, or\npair programming sessions where I want to show notes to whoever in real-time.`}</p>\n    <p>{`In this blog post, I'll explain how I setup screen mirroring from my iPad to a\nNixOS based setup. Whether you are using NixOS as your daily driver or just want\nto try out screen mirroring on a `}{`*`}{`nix based system, hopefully my experience and\nlearnings can be helpful for you.`}</p>\n    <h2 {...{\n      \"id\": \"prerequisites\"\n    }}>{`Prerequisites`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`An iPad with screen mirroring capabilities.`}</li>\n      <li parentName=\"ol\">{`A laptop or desktop computer running `}<a parentName=\"li\" {...{\n          \"href\": \"https://nixos.org/\"\n        }}>{`NixOS`}</a>{`.`}</li>\n      <li parentName=\"ol\">{`Both devices connected to the same local network`}</li>\n    </ol>\n    <p>{`Note that for the rest of this tutorial I'm running NixOS 22.11 (Raccoon) and\nan iPad (6th gen) running iOS 16.2.`}</p>\n    <h2 {...{\n      \"id\": \"setting-up-an-airplay-receiver-on-nixos\"\n    }}>{`Setting up an AirPlay receiver on NixOS`}</h2>\n    <p>{`Apple devices canonically talk to each other via `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.apple.com/airplay/\"\n      }}>{`AirPlay`}</a>{`, so in order to\nmirror an iPad to NixOS, we need to setup an AirPlay \"receiver\" server.`}</p>\n    <p>{`There are many open source AirPlay receivers, but I chose to use `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/FDH2/UxPlay\"\n      }}>{`UxPlay`}</a>{` simply\nbecause it was the first one I came across and it's in `}<inlineCode parentName=\"p\">{`nixpkgs`}</inlineCode>{`.`}</p>\n    <p>{`Now unfortunately if we start running the receiver via `}<inlineCode parentName=\"p\">{`nix run\n  nixpkgs#uxplay`}</inlineCode>{`, the iPad won't see anything ðŸ˜“. This is expected though\nbecause the receiver has no way of interacting with the `}<a parentName=\"p\" {...{\n        \"href\": \"https://openairplay.github.io/airplay-spec/service_discovery.html\"\n      }}>{`service discover`}</a>{`\nmechanism of AirPlay which is mDNS.`}</p>\n    <p>{`The UxPlay README recommends using `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/lathiat/avahi\"\n      }}>{`Avahi`}</a>{` for doing mDNS. Luckily `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/NixOS/nixpkgs/blob/release-22.11/nixos/modules/services/networking/avahi-daemon.nix\"\n      }}>{`Avahi is\navailable for NixOS`}</a>{` so we can add it too our `}<inlineCode parentName=\"p\">{`configuration.nix`}</inlineCode>{` as follows:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-nix\"\n      }}>{`services.avahi = {\n  nssmdns = true;\n  enable = true;\n  publish = {\n    enable = true;\n    userServices = true;\n    domain = true;\n  };\n};\n`}</code></pre>\n    <p>{`Now after a `}<inlineCode parentName=\"p\">{`nixos-rebuild switch`}</inlineCode>{` we should be running Avahi`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-text\"\n      }}>{`$ systemctl status avahi-daemon.service\n* avahi-daemon.service - Avahi mDNS/DNS-SD Stack\n     Loaded: loaded (/etc/systemd/system/avahi-daemon.service; enabled; preset: enabled)\n     Active: active (running) since Tue 2022-12-27 09:12:57 EST; 13s ago\nTriggeredBy: * avahi-daemon.socket\n   Main PID: 245105 (avahi-daemon)\n     Status: \"Server startup complete.\"\n         IP: 8.8K in, 8.8K out\n         IO: 0B read, 0B written\n      Tasks: 1 (limit: 38114)\n     Memory: 628.0K\n        CPU: 22ms\n     CGroup: /system.slice/avahi-daemon.service\n             \\`-245105 \"avahi-daemon: running [spam.local]\"\n\nDec 27 09:12:57 spam avahi-daemon[245105]: New relevant interface lo.IPv4 for mDNS.\nDec 27 09:12:57 spam avahi-daemon[245105]: Network interface enumeration completed.\n...\n`}</code></pre>\n    <p>{`Now if we try running UxPlay again, we should see our airplay receiver show up\nin the screen mirror.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"886px\"\n        }\n      }}>{`\n      `}<span parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-background-image\",\n          \"style\": {\n            \"paddingBottom\": \"90.18058690744921%\",\n            \"position\": \"relative\",\n            \"bottom\": \"0\",\n            \"left\": \"0\",\n            \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAEDAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQIA/9oADAMBAAIQAxAAAAHnVzTcbCSWwM4jb//EABsQAAICAwEAAAAAAAAAAAAAAAECABADETFB/9oACAEBAAEFAnZteTJQ4Ia//8QAFhEAAwAAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/ASv/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAZEAABBQAAAAAAAAAAAAAAAAABABAgMVH/2gAIAQEABj8CGK2Ev//EABsQAQACAwEBAAAAAAAAAAAAAAEAIRARYTFB/9oACAEBAAE/IUD8citiCwgd6bl9gph6x//aAAwDAQACAAMAAAAQyyg8/8QAFhEBAQEAAAAAAAAAAAAAAAAAASEg/9oACAEDAQE/EBkw/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQESH/2gAIAQIBAT8Qa0qf/8QAHRABAAMAAQUAAAAAAAAAAAAAAQARQTEQIVHh8P/aAAgBAQABPxDCTQlq+qHQO3InqO06TAFZEqmohZ4Jy6n/2Q==')\",\n            \"backgroundSize\": \"cover\",\n            \"display\": \"block\"\n          }\n        }}></span>{`\n  `}<picture parentName=\"span\">{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/static/368f9a50ff89a22b7e6035f2e9241af2/3fa74/ipad_screenshot.webp 886w\"],\n            \"sizes\": \"(max-width: 886px) 100vw, 886px\",\n            \"type\": \"image/webp\"\n          }}></source>{`\n          `}<source parentName=\"picture\" {...{\n            \"srcSet\": [\"/static/368f9a50ff89a22b7e6035f2e9241af2/35822/ipad_screenshot.jpg 886w\"],\n            \"sizes\": \"(max-width: 886px) 100vw, 886px\",\n            \"type\": \"image/jpeg\"\n          }}></source>{`\n          `}<img parentName=\"picture\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"src\": \"/static/368f9a50ff89a22b7e6035f2e9241af2/35822/ipad_screenshot.jpg\",\n            \"alt\": \"img\",\n            \"title\": \"my iPad seeing UxPlay!\",\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            }\n          }}></img>{`\n        `}</picture>{`\n    `}</span></p>\n    <p>{`This is great! However if we try to connect we will just end up with a\ntimeout. What gives?`}</p>\n    <p>{`After breaking out Wireshark it was obvious that is was a firewall issue. The\nsimple remedy to this problem was to set `}<inlineCode parentName=\"p\">{`networking.firewall.enable = false;`}</inlineCode>{`\nin the `}<inlineCode parentName=\"p\">{`configuration.nix`}</inlineCode>{`. But this is in general a bad idea and should be\navoided.`}</p>\n    <p>{`Instead I went with a uxplay + iptables + bash approach so while the uxplay is\nrunning, iptables will allow incoming traffic to all necessary ports, and on\nexit, will close them again.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`#! /usr/bin/env nix-shell\n#! nix-shell --quiet -p uxplay -i bash\n\nset -ueo pipefail\n\n## Clear any existing \"DROP ME\" rules\n## ref: https://stackoverflow.com/a/63855690/12393422\nwhile sudo iptables -L -n --line-number | grep \"DROP ME\" > /dev/null; do\n  sudo iptables -D INPUT $(sudo iptables -L -n --line-number | grep \"DROP ME\" | head -1 | awk '{print $1}');\ndone\n\n\nLOCAL_CIDR=\\${1:-\"192.168.0.0/16\"}\n\nopen-port-tcp() {\n  local port=$1\n  echo \"Opening tcp port $port from $LOCAL_CIDR ...\"\n  sudo iptables \\\\\n       -I INPUT \\\\\n       -p tcp \\\\\n       -s $LOCAL_CIDR \\\\\n       --dport $port \\\\\n       -j ACCEPT \\\\\n       -m comment --comment \"DROP ME\"\n}\n\nclose-port-tcp() {\n  local port=\\${1:-0}\n  echo \"Closing tcp port $port from $LOCAL_CIDR ...\"\n  sudo iptables \\\\\n       -D INPUT \\\\\n       -p tcp \\\\\n       -s $LOCAL_CIDR \\\\\n       --dport $port \\\\\n       -j ACCEPT \\\\\n       -m comment --comment \"DROP ME\"\n}\n\nopen-port-udp() {\n  local port=$1\n  echo \"Opening udp port $port from $LOCAL_CIDR ...\"\n  sudo iptables \\\\\n       -I INPUT \\\\\n       -p udp \\\\\n       -s $LOCAL_CIDR \\\\\n       --dport $port \\\\\n       -j ACCEPT \\\\\n       -m comment --comment \"DROP ME\"\n}\n\nclose-port-udp() {\n  local port=\\${1:-0}\n  echo \"Closing udp port $port from $LOCAL_CIDR ...\"\n  sudo iptables \\\\\n       -D INPUT \\\\\n       -p udp \\\\\n       -s $LOCAL_CIDR \\\\\n       --dport $port \\\\\n       -j ACCEPT \\\\\n       -m comment --comment \"DROP ME\"\n}\n\nopen-port-tcp 7100\nopen-port-tcp 7000\nopen-port-tcp 7001\nopen-port-udp 6000\nopen-port-udp 6001\nopen-port-udp 7011\n\n# Ensure port closes if error occurs.\ntrap \"close-port-tcp 7100 && \\\\\n      close-port-tcp 7000 && \\\\\n      close-port-tcp 7001 && \\\\\n      close-port-udp 6000 && \\\\\n      close-port-udp 6001 && \\\\\n      close-port-udp 7011\n      \" EXIT\n\nuxplay -p\n\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sh\"\n      }}>{`$ ipad_screen_mirror_server\nOpening tcp port 7100 from 192.168.0.0/16 ...\nOpening tcp port 7000 from 192.168.0.0/16 ...\nOpening tcp port 7001 from 192.168.0.0/16 ...\nOpening udp port 6000 from 192.168.0.0/16 ...\nOpening udp port 6001 from 192.168.0.0/16 ...\nOpening udp port 7011 from 192.168.0.0/16 ...\nusing network ports UDP 7011 6001 6000 TCP 7100 7000 7001\nusing system MAC address xx:xx:xx:xx:xx:xx\nInitialized server socket(s)\n`}</code></pre>\n    <p>{`Here is the `}<a parentName=\"p\" {...{\n        \"href\": \"https://gist.github.com/cmrfrd/fe8f61da076f8a4a751bf8fc8cb579a5\"\n      }}>{`gist`}</a>{` for those interested.`}</p>\n    <p>{`Now wrapping all this code into a simple script gives us an easy way to easily\nspin up an Airplay receiver server!`}</p>\n    <p>{`If you want to learn more about screen mirroring or NixOS, here are some\nadditional resources you might find helpful:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`NixOS documentation (`}<a parentName=\"li\" {...{\n          \"href\": \"https://nixos.org/manual/\"\n        }}>{`https://nixos.org/manual/`}</a>{`)`}</li>\n      <li parentName=\"ul\">{`mDNS RFC (`}<a parentName=\"li\" {...{\n          \"href\": \"https://www.rfc-editor.org/rfc/rfc6762.html\"\n        }}>{`https://www.rfc-editor.org/rfc/rfc6762.html`}</a>{`)`}</li>\n      <li parentName=\"ul\">{`Publish a service with Avahi on NixOS\n(`}<a parentName=\"li\" {...{\n          \"href\": \"https://blog.stigok.com/2019/12/09/nixos-avahi-publish-service.html\"\n        }}>{`https://blog.stigok.com/2019/12/09/nixos-avahi-publish-service.html`}</a>{`)`}</li>\n      <li parentName=\"ul\">{`OpenAirplay Spec (`}<a parentName=\"li\" {...{\n          \"href\": \"https://openairplay.github.io/airplay-spec/introduction.html\"\n        }}>{`https://openairplay.github.io/airplay-spec/introduction.html`}</a>{`)`}</li>\n    </ul>\n    <p>{`I hope you found this useful, let me know if you have any other tips or tricks\nfor screen mirroring on NixOS!`}</p>\n    <p>{`(à¸‡ Í Â° ÍŸÙ„Íœ Í¡Â°)à¸‡`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"sourceRoot":""}