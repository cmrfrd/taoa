---
title: "This post mines crypto"
author: ["Alexander Comerford"]
date: 2022-04-21
hero: ./images/hero.png
secret: false
excerpt: Is it really feasible to mine in the browser
---

<Miner running={true} />

<WalletState preText="This post has made " />

Thanks for coming by!

If the box above shows "running" then congratulations! You are actively
contributing hash power to the Monero proof of work consensus algorithm!

If you have no idea what that means, then don't worry about it! Just know that
keeping this tab open supports me in writing more content online ðŸ’ž

For those of you that *do* know what this means, you are most likely thinking
"how is this even possible?"

Keep reading to find out.

You might have a lot of questions right now so I'm going to try and
pre-emptively answer as many as I can.

## What is this post about?

An overview on how cryptocurrency mining works, and how to do it in the browser.

## How did you make this?

Webassembly and a little crypto knowledge (I'll elaborate on this later ðŸ‘‡).

## But isn't this crypto-jacking?

Kinda not really. Crypto-jacking implies I'm trying to actively steal your CPU
power, instead I'm enabling you to donate your CPU power as a way to support an
up and coming creator!

## Is the $ this post has made up to date?

It should be! Come back in a few days to see what the current revenue of this
post is!

## How does this even work?

This is a bit of a big question so I'm going to break it down into smaller
pieces.

## How does mining work?

Cryptocurrency mining has been around for so long and has been written about so
much, the internet can explain it better than I ever could.

Here are some top notch pre-requisite links that explain mining on a deeper level:

- [https://monerodocs.org/proof-of-work/pow-in-cryptocurrencies/](https://monerodocs.org/proof-of-work/pow-in-cryptocurrencies/)
- [https://andersbrownworth.com/blockchain/](https://andersbrownworth.com/blockchain/)
- [https://ethereum.org/en/developers/docs/consensus-mechanisms/pow/](https://ethereum.org/en/developers/docs/consensus-mechanisms/pow/)
- [https://academy.bit2me.com/en/que-algoritmo-mineria-randomx-monero](https://academy.bit2me.com/en/que-algoritmo-mineria-randomx-monero)

If you don't wanna read this material, than just know that mining is the process
of many computers competing to solve math puzzles.

On any given day millions of computers compete to solve these puzzles and are
incentivized with a cryptocurrency reward (which has become quite valuable to
many). It's important to understand that this reward (called the "coinbase"
transaction) only goes to one address. This means that finding a solution is
binary (you either find it or you don't) and that this system is a "winner takes
all" competition.

Unfortunately this puts those who only have a few computers at a disadvantage
because more compute means more chances to "win" this competition.

Luckily all hope isn't lost to those who have little compute but want the reward.

Enter pool mining.

## How does pool mining work?

Pool mining is simply the "pooling" or aggregation of compute resources from
many miners in an effort to be competitive in solving these math puzzles.

In fact, it's very hard (and expensive) to compete as a "solo miner" and
nowadays almost all mining is done in pools.

You might have a lingering question in the back of your mind at this point. If
this proof of work system is a "one winner takes all" kind of thing, then how can
many people get rewarded?

This is where is gets interesting.

Instead of pool miners putting their personal wallet address in the coinbase
transaction, they put the mining pools address. They then "prove" to the mining
pool (which is usually a centralized service), that they have found "partial"
solutions (called shares) and get paid according to the shares that they have
submitted.

You can get into the weeds about mining pool payout methods and the differences
between PPS, FPPS, PPS+, and PPLNS, but it's unnecessary. Just know that they
are all based on getting paid based on how much "work" you've contributed.

## How does this post actually mine?

Alright, enough with the cryptocurrency theory and definitions and what
not. Let's break down how this post mines piece, by piece.

## Piece 1: The browser miner

We all stand on the shoulders of giants, and the giants I'm standing on are based
on the work of these people:

- [https://github.com/notgiven688/webminerpool](https://github.com/notgiven688/webminerpool) (and it's many forks)
- [https://github.com/JayWalker512/CryptoNoter](https://github.com/JayWalker512/CryptoNoter)
- [https://github.com/howardchung/jsminer](https://github.com/howardchung/jsminer)

The miner is the heart beat of the entire proof of work system, it's the part
that actually "does" the computing and create hashes in an attempt to solve the
puzzles. Every cryptocurrency uses slightly different algorithms to make this
possible so implementations are cryptocurrency-specific.

The cryptocurrency that this post mines is Monero, meaning the miner
implementation needs to abide by the algorithms Monero uses. The name of the
algorithm in this case is
[Cryptonight](https://monerodocs.org/proof-of-work/cryptonight/).

> The latest version/fork of Monero uses a new algorithm called RandomX, but the
> mining pool this post uses allows for Cryptonight mining (which is easier for
> desktop computers).

Once this page loads, a webworker+miner is run per core available (via `window.navigator.hardwareConcurrency`). Shares are then actively computed in a WASM compiled implementation of Cryptonight ([compiled from here](https://github.com/notgiven688/webminerpool/blob/master/hash_cn/libhash/main.c)) and sent to the pool.

## Piece 2: Connecting to the pool

Most mining pools communicate via the
"[stratum](https://en.bitcoinwiki.org/wiki/Stratum_mining_protocol)" protocol
(which is just glorified JSON over a tcp socket).

But fortunately, some pools support communication over websockets making
communication from the browser possible!

This post connects to the pool via websockets and proxies shares from the
workers, directly to the pool. An intermediary nginx proxy (running on
[fly.io](fly.io)) is used just in case the browser blocks the pool address ðŸ˜‰.

Heres a little diagram of the whole setup:

![img](./images/miner-arch.png "Architecture of this post")

## Piece 3: Seeing rewards

Monero transactions are
"[private](https://www.getmonero.org/get-started/what-is-monero/)" by
default. This means that any Monero sent to an
[address](https://monerodocs.org/public-address/standard-address/) has a
"hidden" amount, sender, and reciever. All of which is secured via advanced
cryptography (specifically via [Ring
Signatures](https://www.getmonero.org/resources/moneropedia/ringsignatures.html)).

Even though Monero wallets are private, we can still publish our wallet balance.

This is because every Monero wallet comes with two sets of keys, one for
spending and one for viewing. By publishing our wallet address and view key, our
balance can be transparent to the public which is great for an application like
this!

Here is the wallet and view key for your viewing convenience:

<WalletInfo />

## Why did you do this?

Because it's cool!

On a serious level though I built this so I could understand crypto mining at a
deeper level (and potentially make some money while doing it ðŸ’°)!

I also wanted to experiment with the idea of using mining as an alternative
monitization method to ads, even though [it's been
shown](https://ifip.byu.edu/2019/DRW2019_paper_23.pdf) to be a rather inferior
method.

Cryptocurrency is quite a spectacular technology and we've only scratched the surface of what we can do with it. So much of it is unknown, no one knows what it means!

![img](/img/Its_provocative.gif)

Thanks for reading! Ê•â€¢á´¥â€¢Ê”
